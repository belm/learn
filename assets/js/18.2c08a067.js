(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{373:function(n,e,t){"use strict";t.r(e);var s=t(45),a=Object(s.a)({},(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"jenkins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[n._v("#")]),n._v(" jenkins")]),n._v(" "),t("p",[n._v("安装")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("下载jdk8\nhttps://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html\n\n解压到\n/usr/local/app/jdk1.8.0_271\n\n修改/etc/profile 添加环境变量\nexport PATH=$PATH:/usr/local/app/jdk1.8.0_271/bin\n\nsource /etc/profile\n\n下载jenkins.war文件\n启动jenkins\nnohup java -jar jenkins.war --httpPort=8080 &\n\n查看密码\ncat /home/nobody/.jenkins/secrets/initialAdminPassword\n")])])]),t("p",[n._v("Jenkinsfile文件示例")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("pipeline {\n    agent any\n    stages {\n        stage('Build') {\n            steps {\n                retry(3){\n                    sh 'echo \"Hello World\"'   \n                }\n                \n                timeout(time: 1, unit: 'MINUTES') {\n                    sh '''\n                        echo \"Multiline shell steps works too\"\n                        ls -lah\n                    '''   \n                }\n            }\n        }\n    }\n    post {\n        always {\n            echo 'This will always run'\n        }\n        success {\n            echo 'This will run only if successful'\n        }\n        failure {\n            echo 'This will run only if failed'\n        }\n        unstable {\n            echo 'This will run only if the run was marked as unstable'\n        }\n        changed {\n            echo 'This will run only if the state of the Pipeline has changed'\n            echo 'For example, if the Pipeline was previously failing but is now successful'\n        }\n    }\n}\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("pipeline {\n    agent any\n    environment {\n        // 定义项目名称方便全局引用\n        project     = \"test-php\"\n    }\n    triggers {\n        gitlab( triggerOnPush: true, \n                triggerOnMergeRequest: true, \n                branchFilterType: 'All'\n        )\n    }\n    options {\n        timestamps()\n        disableConcurrentBuilds()\n        timeout(time: 10, unit: 'MINUTES')\n        buildDiscarder(logRotator(numToKeepStr: '10'))\n    }\n    // 这里使用参数化构建的方式，而没有使用input参数，下边会说明一下原因。\n    parameters {\n        choice(name: 'MODE', choices: ['deploy','rollback'], description: '请选择发布或者回滚？')\n    }\n    stages {\n        stage('部署') {\n            when {\n                environment name: 'MODE',value: 'deploy'\n            }\n            steps {\n                script {\n                    try {\n                        sh '''\n                            echo \"部署\"\n                        '''\n                    } catch(err) {\n                        echo \"${err}\"\n                    }\n                }\n            }\n        }\n        stage('回滚') {\n            when {\n                environment name: 'MODE',value: 'rollback'\n            }\n            steps {\n                script {\n                    try {\n                        sh '''\n                            echo \"回滚\"\n                        '''\n                    } catch(err) {\n                        echo \"${err}\"\n                    }\n                }\n            }\n        }\n        stage('清理工作空间') {\n            steps {\n                echo '清理工作空间'\n                cleanWs()\n            }\n        }\n    }\n    post {\n        success {\n            dingtalk (\n                                    robot: 'ff2c6f85-9f69-411a-86c6-00bce2581122',\n                                    type: 'TEXT',\n                                    text: [\n                                        '测试成功文本类型的消息',\n                                        '分行显示，哈哈哈哈'\n                                    ],\n                                    at: [\n                                        '16602102151'\n                                    ]\n                     )\n        }\n        failure {\n            dingtalk (\n                                    robot: 'ff2c6f85-9f69-411a-86c6-00bce2581122',\n                                    type: 'TEXT',\n                                    text: [\n                                        '测试失败文本类型的消息',\n                                        '分行显示，哈哈哈哈'\n                                    ],\n                                    at: [\n                                        '16602102151'\n                                    ]\n                    )\n        }\n    }\n}\n")])])])])}),[],!1,null,null,null);e.default=a.exports}}]);